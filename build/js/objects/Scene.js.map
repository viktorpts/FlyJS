{"version":3,"sources":["../../../js/objects/Scene.js"],"names":["Scene","constructor","static","dynamic","toAdd","toRemove","toRemoveScenery","particleCooldown","addObject","obj","push","update","spawnedParticle","i","length","alive","shooting","bullet","x","y","direction","accelerate","Math","abs","velX","velY","cos","sin","splice"],"mappings":"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","file":"Scene.js","sourcesContent":["import Character from './dynamic/Character.js';\r\nimport Backdrop from './static/Backdrop.js';\r\nimport Bullet from './dynamic/Missile.js';\r\nimport Smoke from './static/Smoke.js';\r\n\r\nexport default class Scene {\r\n    constructor() {\r\n        this.static = [];\r\n        this.dynamic = [];\r\n        this.toAdd = [];\r\n        this.toRemove = [];\r\n        this.toRemoveScenery = [];\r\n        this.particleCooldown = 0;\r\n    }\r\n\r\n    addObject(obj) {\r\n        // Typecheck static or dynamic\r\n        if (obj instanceof Character) {\r\n            this.dynamic.push(obj);\r\n        } else if (obj instanceof Backdrop) {\r\n            this.static.push(obj);\r\n        }\r\n    }\r\n\r\n    update() {\r\n        let spawnedParticle = false;\r\n        if (this.particleCooldown > 0) {\r\n            this.particleCooldown -= 1;\r\n        }\r\n\r\n        // Update scenery\r\n        for (let i = 0; i < this.static.length; i++) {\r\n            let obj = this.static[i];\r\n            obj.update();\r\n            if (!obj.alive) {\r\n                this.toRemoveScenery.push(i);\r\n            }\r\n        }\r\n\r\n\r\n        // Update objects\r\n        for (let i = 0; i < this.dynamic.length; i++) {\r\n            let obj = this.dynamic[i];\r\n            obj.update();\r\n            if (!obj.alive) {\r\n                this.toRemove.push(i);\r\n                continue;\r\n            }\r\n            if (obj.shooting) {     // User input - shoot\r\n                let bullet = new Bullet(obj.x, obj.y);\r\n                bullet.direction = obj.direction;\r\n                bullet.accelerate(10);\r\n                this.toAdd.push(bullet);\r\n                obj.shooting = false;\r\n            }\r\n            if (Math.abs(obj.velX) > 0.2 || Math.abs(obj.velY) > 0.2) {     // Particle emitters\r\n                if (this.particleCooldown <= 0) {\r\n                    spawnedParticle = true;\r\n                    let x = obj.x - Math.cos(obj.direction) * 24;\r\n                    let y = obj.y - Math.sin(obj.direction) * 24;\r\n\r\n                    this.toAdd.push(new Smoke(x, y));\r\n                }\r\n            }\r\n        }\r\n        if (spawnedParticle) {      // Limit particle emission\r\n            this.particleCooldown = 3;\r\n        }\r\n\r\n        for (let i = 0; i < this.toAdd.length; i++) {\r\n            this.addObject(this.toAdd[i]);\r\n        }\r\n        this.toAdd.length = 0;\r\n        for (let i = this.toRemove.length - 1; i >=0 ; i--) {\r\n            this.dynamic.splice(this.toRemove[i], 1);\r\n        }\r\n        this.toRemove.length = 0;\r\n        for (let i = this.toRemoveScenery.length - 1; i >=0 ; i--) {\r\n            this.static.splice(this.toRemoveScenery[i], 1);\r\n        }\r\n        this.toRemoveScenery.length = 0;\r\n    }\r\n}"]}